extends layout
block link
    // jQuery UI
    link(rel="stylesheet" href="/javascripts/jquery-ui/jquery-ui.min.css")
    // AnimateCSS
    link(rel="stylesheet" href="/stylesheets/animate.min.css")
    // MaterializeCSS
    link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css")
    // Materialize Icons
    link(href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet")
    // Datatables
    link(rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css")
    // Custom Css
    link(rel="stylesheet" href="/stylesheets/style.css")
block header
    header
        .navbar-fixed
            nav.indigo.darken-3
                .container
                    .nav-wrapper
                    a.brand-logo SIG Bétera
                    ul#nav-mobile.right.hide-on-med-and-down
                        li
                            a(href="/visor") Visor
block content
    // Div visible Inicio
    #inicio.visible_bet(style="left : 300px; top : 64px; right : 0px; bottom : 0px; position : absolute; background : rgba(0,0,0,0.5)") Inicio
    #usuarios(style="left : 300px; top : 64px; right : 0px; bottom : 0px; position : absolute; visibility : hidden; margin : 15px;") Usuarios
        table#usuarios_table.display.highlight(cellspacing="0" width="100%")
            thead
                tr
                    th.no-sort
                    each k in ['id', 'name', 'email', 'rol', 'grupos']
                        th #{k}
            tbody
                each user in allUsers
                    tr
                        td.no-sort(user-id="#{user.id}")
                            i.user-detail-btn.material-icons.green-text(style="cursor : pointer;") mode_edit
                        each k in ['id', 'name', 'email', 'rol']
                            td #{user[k]}
                        td #{ (user['grupos'] || []).join(', ')}
    #mapas(style="left : 300px; top : 64px; right : 0px; bottom : 0px; position : absolute; visibility : hidden; margin : 15px;")
        .card-panel.indigo.white-text Todos los mapas
            i.create-map-btn.material-icons.white-text(style="float : right; cursor : pointer;") add_circle_outline
        table#mapas-table.display.highlight(cellspacing="0" width="100%")
            thead
                tr
                    each k in ['id', 'name', 'layers', 'baselayers']
                        th #{k}
                    th.no-sort
                        i.material-icons(style="cursor : default; ") mode_edit
                    th.no-sort
                        i.material-icons(style="cursor : default; ") remove_circle_outline
            tbody
                each mapa in allMaps.sort(function(a, b){ return a.id > b.id})
                    tr
                        each k in ['id', 'name', 'layers', 'baselayers']
                            td #{mapa[k]}
                        td
                            i.green-text.edit-map-btn.material-icons(map-id="#{mapa.id}" style="cursor : pointer;") mode_edit
                        td
                            i.red-text.delete-map-btn.material-icons(map-id="#{mapa.id}" style="cursor : pointer;") remove_circle_outline
        .card-panel.indigo.white-text Mapas default
            i.create-map-default-btn.material-icons.white-text(style="float : right; cursor : pointer;") add_circle_outline
        table#mapas-default-table.display.highlight(cellspacing="0" width="100%")
            thead
                tr
                    each k in ['id', 'name', 'layers', 'baselayers']
                        th #{k}
                    th.no-sort
                        i.material-icons(style="cursor : default; ") remove_circle_outline
            tbody
                each mapa in (allDefaultMaps || []).sort(function(a, b){ return a.id > b.id})
                    tr
                        each k in Object.keys((allDefaultMaps[0] || []))
                            td #{mapa[k]}
                        td
                            i.red-text.delete-map-default-btn.material-icons(map-id="#{mapa.id}" style="cursor : pointer;") remove_circle_outline
    #capas(style="left : 300px; top : 64px; right : 0px; bottom : 0px; position : absolute; visibility : hidden; margin : 15px;")
        .card-panel.indigo.white-text Capas PostGIS
        table#capas_table.display.highlight(cellspacing="0" width="100%")
            thead
                tr
                    each k in Object.keys(allLayers[0])
                        th #{k}
            tbody
                each capa in allLayers.sort(function(a, b){ return a.id > b.id})
                    tr
                        each k in Object.keys(allLayers[0])
                            td #{capa[k]}
        .card-panel.indigo.white-text Servicios WMS
        table#capas_wms_table.display.highlight(cellspacing="0" width="100%")
            thead
                tr
                    each k in Object.keys(allBaseLayers[0])
                        th #{k}
            tbody
                each capa in allBaseLayers.sort(function(a, b){ return a.id > b.id})
                    tr
                        each k in Object.keys(allBaseLayers[0])
                            td #{capa[k]}
    #mail(style="left : 300px; top : 64px; right : 0px; bottom : 0px; position : absolute; visibility : hidden; margin : 15px;")
        .card-panel.col.s12.indigo.white-text Usuarios
        .col.s12
            ul.collapsible(data-collapsible='accordion')
                each grupo in allGroups
                    li
                        .collapsible-header.indigo-text
                            form(action="#")
                                input.input-group(type='checkbox' id="#{grupo}")
                                label.indigo-text(for="#{grupo}") #{grupo}
                        .collapsible-body
                            ul.collection
                                each user in allUsers.reduce(function(a, b){ if(b.grupos.indexOf(grupo) > -1) a.push(b); return a;}, [])
                                    li.collection-item
                                        form(style="margin-left : 3em;" action="#")
                                            input.input-user(type='checkbox' id="#{grupo}-#{user.name}")
                                            label(for="#{grupo}-#{user.name}") Nombre : #{user.name}   Email : #{user.email}
    // Menú lateral
    ul#slide-out.side-nav.fixed(style="margin-top : 64px;")
        a#close-sidenav(href="#" style="position : absolute ; right : 0em; top : 0em; font-size : 2em; z-index : 1;" class="material-icons red-text hide-on-large-only") clear
        li(style="background : url('http://www.betera.com/wp-content/uploads/policia-local-31.jpg'); background-size : 150%;")
            .userView
                a()
                    i.material-icons.prefix.circle.white-text.darken-2(style="font-size : 5em;") account_circle
                if (user)
                    a()
                        span.black-text.name #{user.name}
                    a(href='#!email')
                        span.black-text.email #{user.email}
                else
                    a()
                        span.black-text.name Usuario Invitado
                    a()
                        span.black-text.email -----			

        li.bold.active
            a(href='/') 
                | Inicio
                i.material-icons.indigo-text(style="float : right") home
        li
            .divider
        li.bold
            a.waves-effect(href='#usuarios' data-href='#usuarios')
                | Usuarios
                i.material-icons.blue-text(style="float : right") person_pin
        li
            .divider
        li.bold
            a.waves-effect(href='#mapas' data-href='#mapas')
                | Mapas
                i.material-icons.green-text(style="float : right") map
        li
            .divider
        li.bold
            a.waves-effect(href='#capas' data-href='#capas')
                | Capas
                i.material-icons.orange-text(style="float : right") layers
        li
            .divider
        li.bold
            a.waves-effect(href='#mail' data-href='#mail')
                | Mail
                i.material-icons.red-text(style="float : right") mail_outline
        li
            .divider
        li
            a.subheader Footer Prueba
    // Modal Structure
    #user-detail.modal.modal-fixed-footer
        .modal-header.card-panel.indigo.white-text(style="pointer : default !important; margin-top : 0px;") Editar Usuario
        .modal-content
        .modal-footer
            a.modal-action.modal-close.waves-effect.waves-green.btn-flat(href='#!') Cerrar
    #new-map.modal.modal-fixed-footer
        .modal-header.card-panel.indigo.white-text(style="pointer : default !important; margin-top : 0px;") Nuevo Mapa
        .modal-content.row
            form#new-map-form(method="POST" action="/")
                .col.s10
                    input.col.s12(type="text" placeholder="Añade nombre para nuevo mapa" name="name")
                .col.s2
                    button.btn.waves-effect.waves-light(name="action" type="submit") Crear
                        i.material-icons.right send
        .modal-footer
            a.modal-action.modal-close.waves-effect.waves-green.btn-flat(href='#!') Cerrar
    #new-map-default.modal.modal-fixed-footer
        .modal-header.card-panel.indigo.white-text(style="pointer : default !important; margin-top : 0px;") Añadir Mapa Default
        .modal-content.row
            .col.s12
                select.col.s12(placeholder="Elige un mapa para hacerlo default" name="name")
                    option(disabled selected value="") Elige un mapa para hacerlo default
                    each map in allMaps.reduce(function(list, m){ if( (allDefaultMaps || []).map(function(a){return a.id;}).indexOf(m.id) == -1)list.push(m);return list;}, [])
                        option(value="#{map.id}") #{map.name}
        .modal-footer
            a.modal-action.modal-close.waves-effect.waves-green.btn-flat(href='#!') Cerrar
    #edit-map.modal.modal-fixed-footer
        .modal-header.card-panel.indigo.white-text(style="pointer : default !important; margin-top : 0px;") Editar mapa
        .modal-content(style="height: calc(100% - 120px)")
        .modal-footer
            a.modal-action.modal-close.waves-effect.waves-green.btn-flat(href='#!') Cerrar

block script
    // jQuery
    script(src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous")
    // jQuery UI
    script(src="/javascripts/jquery-ui/jquery-ui.min.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js")
    script(src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js")
    script.
        var allUsers = JSON.parse('!{JSON.stringify(allUsers)}');
        var allMaps = JSON.parse('!{JSON.stringify(allMaps)}');
        var allDefaultMaps = JSON.parse('!{JSON.stringify(allDefaultMaps)}');
        var allLayers = JSON.parse('!{JSON.stringify(allLayers)}');
        var allBaseLayers = JSON.parse('!{JSON.stringify(allBaseLayers)}');
        var allGroups = JSON.parse('!{JSON.stringify(allGroups)}');
        $('.collapsible').collapsible();
    script(src="/javascripts/admin.js")